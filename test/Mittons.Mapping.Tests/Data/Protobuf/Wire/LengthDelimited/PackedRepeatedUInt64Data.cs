namespace Mittons.Mapping.Tests.Data.Protobuf.Wire.LengthDelimited;

internal class PackedRepeatedUInt64Data : DataSourceGeneratorAttribute<byte[], ulong[]>
{
    protected override IEnumerable<Func<(byte[], ulong[])>> GenerateDataSources(DataGeneratorMetadata dataGeneratorMetadata)
    {
        foreach (var variation in CreateVariations([.. PackedRepeatedUInt32Data.PositiveData]))
        {
            yield return () => variation;
        }

        foreach (var variation in CreateVariations(PositiveData))
        {
            yield return () => variation;
        }
    }

    internal static IEnumerable<(byte[], ulong)> PositiveData
    {
        get =>
        [
            ([0xff, 0xff, 0xff, 0xff, 0x7f], 34_359_738_367),
            ([0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 34_359_738_368),
            ([0x81, 0x80, 0x80, 0x80, 0x80, 0x01], 34_359_738_369),
            ([0x82, 0x80, 0x80, 0x80, 0x80, 0x01], 34_359_738_370),
            ([0xff, 0xff, 0xff, 0xff, 0xff, 0x7f], 4_398_046_511_103),
            ([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 4_398_046_511_104),
            ([0x81, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 4_398_046_511_105),
            ([0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 4_398_046_511_106),
            ([0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f], 562_949_953_421_311),
            ([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 562_949_953_421_312),
            ([0x81, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 562_949_953_421_313),
            ([0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 562_949_953_421_314),
            ([0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f], 72_057_594_037_927_935),
            ([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 72_057_594_037_927_936),
            ([0x81, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 72_057_594_037_927_937),
            ([0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 72_057_594_037_927_938),
            ([0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f], 9_223_372_036_854_775_807),
            ([0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 9_223_372_036_854_775_808),
            ([0x81, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 9_223_372_036_854_775_809),
            ([0x82, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x01], 9_223_372_036_854_775_810),
            ([0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x01], ulong.MaxValue),
        ];
    }

    private static IEnumerable<(byte[] bytes, ulong[] value)> CreateVariations(IEnumerable<(byte[] bytes, ulong value)> source)
    {
        foreach (var (bytes, value) in source)
        {
            yield return (bytes, [value]);
        }

        foreach (var (bytes, value) in source.Reverse())
        {
            yield return (bytes, [value]);
        }

        yield return ([.. source.SelectMany(x => x.bytes)], [.. source.Select(x => x.value)]);
    }
}
